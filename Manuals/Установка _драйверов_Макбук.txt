Установка Linux Mint на ноутбук Apple Macbook A1181 2006 г.


1. Апгрейд железа


Вообще-то под названием A1181 скрывается два десятка разных моделей. Более точную информацию дает номер модели, который можно найти под батареей (в моём случае это 2121). В данном ноутбуке был установлен 1 (один) гигабайт оперативной памяти (два модуля по 512 Мбайт) и жесткий диск около 70 Гбайт. И то и другое для современных версий Linux маловато. Поэтому память была увеличена до 3 Гбайт (2+1 гигабайт памяти DDR2 с частотой 667 МГц) - более данная модель не поддерживает. Минимальные системные требования для Linux Mint 21 - это 2 Гбайта ОП, рекомендуется 4, но... что имеем, то имеем.


Жесткий диск лучше заменить на SSD. Во первых, это резко повысит скорость работы (загрузка системы, запуск приложений и т.д.) Во вторых, диск на 500 Гбайт сейчас стоит не так дорого, а увеличение объема почти на порядок - это приятно, не правда ли? По собственному опыту могу сказать, что диски SSD вполне совместимы с данным компьютером.

Ещё одна неприятная особенность данной модели - это EFi (замена BIOS в компьютерах Apple). Процессор в ноутбуке - Intel Core 2 Duo (64-битный). Однако EFI - 32-битная, это вызывает ряд сложностей при установке.

2. Загрузочная флешка.


Все современные версии Linux Mint - 64-битные. Но загрузчик должен быть 32-битным - иначе EFI макбука не сможет загрузить систему. Поэтому обычная загрузочная флешка на макбуке не работает. Да, сразу хочу предупредить - забудьте про использование для установки DVD-привода! 32-битный EFI сходит с ума от загрузочного диска с 64-разрядной системой, и его даже извлечь невозможно. (Приходится разбирать компьютер и привод DVD.)

После ряда экспериментов мне удалось найти два способа создать загрузочную флешку.

Для создания флешки требуется компьютер с установленной системой Linux.

Для любого из описанных ниже вариантов следует взять флешку объемом минимум 4 Гбайт. (Внимание - вся информация на ней будет уничтожена!) Создаем на этой флешке (с помощью Gparted, например) таблицу разделов в формате GPT и единственный раздел максимально возможного размера, отформатированный в FAT32.

Да, флешка должна быть качественной. Если она сбойная - то можно получить ряд самых неожиданных ошибок...

Вариант 1.


1. Создаем на флешке папку EFI и в ней папку BOOT.

2. Скачиваем со страницы http://www.mediafire.com/?dpgorsfdkf6nn2c файл с длинным названием: ISO-2-USB EFI-Booter for Mac 0.01 beta - Ubuntu 10.10 Live.zip

3. Разархивируем этот файл (архив содержит два файла). Копируем эти файлы в папку EFI/BOOT на нашей флешке.

4. В папку EFI/BOOT на флешке копируем дистрибутив Linux Mint в формате .iso

5. Переименовываем дистрибутив на флешке в boot.iso

Флешка готова.


Вариант 2 (предпочтительный).


1. Щелкаем правой кнопкой мыши по iso-файлу с дистрибутивом Linux и открываем его с помошью "Подключение образов дисков".

2. Копируем все файлы и папки из подключенного образа (boot, casper и т.д.) в корень нашей флешки.

3. Скачиваем со страницы https://github.com/lamadotcare/bootia32-efi файл bootia32.efi и копируем его в папку EFI/boot на флешке.

Флешка готова.


Корректно извлекаем флешку из компьютера и переходим к загрузке макбука.


3. Загрузка Linux на макбуке в Live-режиме


Вставляем нашу флешку в разъем USB макбука. Включаем питение макбука и сразу же зажимаем на его клавиаиуре клавишу Alt. На экране появляется перечень устройств для загрузки. Выбираем оранжевый рисунок с подписью EFI-boot и щелкаем по ниму, потом нажимаем на появившуюся под ним стрелочку. Набираемся терпения. Через несколько минут запускается Linux Mint в Live-режиме.


4. Установка Linux Mint на макбук


Рассматривается вариант установки, при котором Linux Mint - единственная ОС на макбуке. При этом диск макбука будат стерт. Если там есть какая-то ценная информация - предварительно сохраните её на внешнем носителе.

Запускаем инсталлятор. При выборе варианта установки выбираем вариант "стереть диск и установить Linux Mint".

Если флешка изготовлена по описанному выше варианту 1, то на предложение отмонтировать подключенные разделы, которое появится в процессе установки, нужно ответить "Yes". Далее появится сообщение, что установщик не может установить загрузчик. Выбираем вариант "Не устанавливать загрузчик" и продолжаем установку. Всё равно загрузчик придется впоследствии устанавливать вручную.

С флешкой, изготовленной по варианту 2, всё должно пройти без каких-либо эксцессов.


Если всё прошло успешно и установка завершилась - можно пробовать запустить Linux на макбуке. Но простая перезагрузка не поможет: надо будет установить 32-битный загрузчик системы.


5. Запуск Linux Mint на макбуке


Нам потребуется флешка-стартер. Если флешка изготовлена по варианту 2 - то стартер у нас уже есть. Загружаемся с этой флешки, и когда на экране появляется стартовое меню ("Start Linux Mint..." и т.п.), нажимаем клавишу C на клавиатуре, чтобы войти в режим командной строки GRUB.

Если флешка была изготовлена по 1-му варианту, то надо заменить файл /EFI/BOOT/bootia32.efi на одноименный файл, скачанный со страницы https://github.com/lamadotcare/bootia32-efi

На экране должно появиться приглашение командной строки GRUB:

grub>

Вводим команду ls и нажимаем "Ввод". В ответ должно появиться что-то вроде

(hd0) (hd0,gpt1) (hd1) (hd1,gpt2) (hd1,gpt1) (cd0)

В нашем случае hd0 - это наша флешка, а hd1 - жесткий диск компьютера. Его последний раздел (hd1,gpt2) - это раздел с установленной системой Linux, а (hd0,gpt1) - это небольшой раздел для установки EFI-загрузчика.

Вводим следующие команды:

grub>set root=(hd1,2)
grub>linux /boot/vmlinuz root=/dev/sda2
grub>initrd /boot/initrd.img
grub>boot


Если на диске hd1 не два, а три раздела, то раздел с системой - 3-й, а раздел EFI - 2-й. Вышеприведенные команды надо соответственно модифицировать (вместо (hd1,2) написать (hd1,3), а вместо sda2 - sda3).

После обильного количества системных сообщений система должна загрузиться.


6. Установка 32-битного загрузчика EFI


Разумеется, каждый раз запускать систему с помощью флешки - это не выход. Поэтому следующая наша задача - это установить нормальный загрузчик. Поскольку в данном ноутбуке 32-битная EFI, то загрузчик должен быть 32-битным.

Запускаем Linux Mint с помощью флешки-стартера, как описано выше.

При установке загрузчика макбук должен быть подключен к интернету (по проводу или по WiFi).

Вводим в терминале следующие команды:

sudo mount /dev/sda1 /boot/efi
(Внимание! Эта команда нужна только для варианта 1 флешки. В случае варианта 2 соответствующее монтирование уже выполнено.)


sudo apt update
sudo apt install grub-efi-ia32-bin
sudo update-grub
sudo grub-install -v --target=i386-efi --efi-directory=/boot/efi /dev/sda1



Выше предполагалось, что раздел EFI - первый на лиске. Если же он второй - вместо sda1 надо писать sda2. Конфигурацию разделов можно посмотреть, например, в программе Gparted (её надо предварительно установить).

Выключаем макбук, вытаскиваем флешку и снова включаем. Если всё прошло как надо - система должна загрузиться с жесткого диска компьютера. Так как железо не слишком мощное, то загрузка займет почти минуту даже при установке на SSD.


7. Подключаем видеокамеру


Видеокамера после установки Linux Mint не работает "из коробки". Поэтому надо поставить необходимое для нее firmware.

Подробное описание процесса можно найти здесь: https://help.ubuntu.com/community/MactelSupportTeam/AppleiSight

Вкратце же делаем следующее:

- Ищем в интернете файл "AppleUSBVideoSupport.zip" (его можно найти, например, на странице https://www.linux.org/threads/installing-linux-on-an-imac.26009/)

- Скачиваем архив и извлекаем из него файл AppleUSBVideoSupport

- Помещаем этот файл куда-нибудь, чтобы путь к нему от корня был покороче (можно, например, в свою домашнюю папку). Можно также переименовать этот файл, дав ему более короткое имя. Всё это рекомендуется потому, что путь к файлу и его имя надо будет вводить с клавиатуры и без ошибок. (Я переименовал его в avs)

- Открываем терминал и вводим команду

sudo apt-get install isight-firmware-tools

Когда появляется окно с вопросом о файле с firmware, отвечаем "Да" и в следующем окне вводим полный путь к файлу и его название.

Если при вводе сделана ошибка, то удаляем установленный пакет командой

sudo apt-get --purge remove isight-firmware-tools

и повторяем процесс. (Опция --purge обязательна!)

Признак успеха - сообщение "Микропрограмма извлечена успешно".

Когда установка пройдет успешно - перезагружаемся. Камера должна заработать.


8. Чиним микрофон

Микрофон после установки у меня не работал. Чтобы он заработал, нужно установить пакет pavucontrol следующей командой в терминале:


sudo apt install pavucontrol


Когда пакет установится, открываем главное меню. В разделе "Аудио и видео" запускаем "Регулятор громкости Pulseaudio". На вкладке "Конфигурация" выбираем режим "Аналоговый стерео дуплекс".


После этого на вкладке "Устройства ввода" можно увеличить громкость микрофона до 100% (иначе звук с микрофона будет слишком тихим).


9. Известные проблемы

Пока не удалось решить проблему со звуком. В динамиках воспроизводится только правый канал (вместо левого - полная тишина). В наушниках, однако, слышны оба канала.


Итог

Итак, в результате мы имеем макбук с установленным линуксом. Разумеется, не стоит ожидать от него слишком многого. Но с интернет-серфингом, чтением почты, работой в офисном пакете (например, установленном "из коробки" LibreOffice), общением по скайпу, просмотром фильмов и т.п. он вполне справится. Главное же - то, что операционная система и приложения вполне современные. Если же пытаться установить на это железо его родную МакОС, то официально на нем не поддерживаются версии выше 10.7 Lion. В этой версии - устаревший браузер, который даже не может открыть большинство современных сайтов. Сторонние же браузеры (Firefox, Google Chrome и пр.) и множество других нужных приложений нельзя установить, ибо они несовместимы с этой древней ОС.
